{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/array-base/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { createContext, useContext } from 'react'\nimport { Button } from 'antd'\nimport {\n  DeleteOutlined,\n  DownOutlined,\n  UpOutlined,\n  PlusOutlined,\n  MenuOutlined,\n  CopyOutlined,\n} from '@ant-design/icons'\nimport { AntdIconProps } from '@ant-design/icons/lib/components/AntdIcon'\nimport { ButtonProps } from 'antd/lib/button'\nimport { ArrayField } from '@formily/core'\nimport {\n  useField,\n  useFieldSchema,\n  Schema,\n  JSXComponent,\n  RecordScope,\n  RecordsScope,\n} from '@formily/react'\nimport { isValid, clone } from '@formily/shared'\nimport { SortableHandle } from 'react-sortable-hoc'\nimport { usePrefixCls } from '../__builtins__'\nimport cls from 'classnames'\n\nexport interface IArrayBaseAdditionProps extends ButtonProps {\n  title?: string\n  method?: 'push' | 'unshift'\n  defaultValue?: any\n}\n\nexport interface IArrayBaseContext {\n  props: IArrayBaseProps\n  field: ArrayField\n  schema: Schema\n}\n\nexport interface IArrayBaseItemProps {\n  index: number\n  record: any\n}\n\nexport type ArrayBaseMixins = {\n  Addition?: React.FC<React.PropsWithChildren<IArrayBaseAdditionProps>>\n  Copy?: React.FC<React.PropsWithChildren<AntdIconProps & { index?: number }>>\n  Remove?: React.FC<React.PropsWithChildren<AntdIconProps & { index?: number }>>\n  MoveUp?: React.FC<React.PropsWithChildren<AntdIconProps & { index?: number }>>\n  MoveDown?: React.FC<\n    React.PropsWithChildren<AntdIconProps & { index?: number }>\n  >\n  SortHandle?: React.FC<\n    React.PropsWithChildren<AntdIconProps & { index?: number }>\n  >\n  Index?: React.FC\n  useArray?: () => IArrayBaseContext\n  useIndex?: (index?: number) => number\n  useRecord?: (record?: number) => any\n}\n\nexport interface IArrayBaseProps {\n  disabled?: boolean\n  onAdd?: (index: number) => void\n  onCopy?: (index: number) => void\n  onRemove?: (index: number) => void\n  onMoveDown?: (index: number) => void\n  onMoveUp?: (index: number) => void\n}\n\ntype ComposedArrayBase = React.FC<React.PropsWithChildren<IArrayBaseProps>> &\n  ArrayBaseMixins & {\n    Item?: React.FC<React.PropsWithChildren<IArrayBaseItemProps>>\n    mixin?: <T extends JSXComponent>(target: T) => T & ArrayBaseMixins\n  }\n\nconst ArrayBaseContext = createContext<IArrayBaseContext>(null)\n\nconst ItemContext = createContext<IArrayBaseItemProps>(null)\n\nconst takeRecord = (val: any) => (typeof val === 'function' ? val() : val)\n\nconst useArray = () => {\n  return useContext(ArrayBaseContext)\n}\n\nconst useIndex = (index?: number) => {\n  const ctx = useContext(ItemContext)\n  return ctx ? ctx.index : index\n}\n\nconst useRecord = (record?: number) => {\n  const ctx = useContext(ItemContext)\n  return takeRecord(ctx ? ctx.record : record)\n}\n\nconst getSchemaDefaultValue = (schema: Schema) => {\n  if (schema?.type === 'array') return []\n  if (schema?.type === 'object') return {}\n  if (schema?.type === 'void') {\n    for (let key in schema.properties) {\n      const value = getSchemaDefaultValue(schema.properties[key])\n      if (isValid(value)) return value\n    }\n  }\n}\n\nconst getDefaultValue = (defaultValue: any, schema: Schema) => {\n  if (isValid(defaultValue)) return clone(defaultValue)\n  if (Array.isArray(schema?.items))\n    return getSchemaDefaultValue(schema.items[0])\n  return getSchemaDefaultValue(schema.items)\n}\n\nexport const ArrayBase: ComposedArrayBase = (props) => {\n  const field = useField<ArrayField>()\n  const schema = useFieldSchema()\n  return (\n    <RecordsScope getRecords={() => field.value}>\n      <ArrayBaseContext.Provider value={{ field, schema, props }}>\n        {props.children}\n      </ArrayBaseContext.Provider>\n    </RecordsScope>\n  )\n}\n\nArrayBase.Item = ({ children, ...props }) => {\n  return (\n    <ItemContext.Provider value={props}>\n      <RecordScope\n        getIndex={() => props.index}\n        getRecord={() => takeRecord(props.record)}\n      >\n        {children}\n      </RecordScope>\n    </ItemContext.Provider>\n  )\n}\n\nconst SortHandle = SortableHandle((props: any) => {\n  const prefixCls = usePrefixCls('formily-array-base')\n  return (\n    <MenuOutlined\n      {...props}\n      className={cls(`${prefixCls}-sort-handle`, props.className)}\n      style={{ ...props.style }}\n    />\n  )\n}) as any\n\nArrayBase.SortHandle = (props) => {\n  const array = useArray()\n  if (!array) return null\n  if (array.field?.pattern !== 'editable') return null\n  return <SortHandle {...props} />\n}\n\nArrayBase.Index = (props) => {\n  const index = useIndex()\n  const prefixCls = usePrefixCls('formily-array-base')\n  return (\n    <span {...props} className={`${prefixCls}-index`}>\n      #{index + 1}.\n    </span>\n  )\n}\n\nArrayBase.Addition = (props) => {\n  const self = useField()\n  const array = useArray()\n  const prefixCls = usePrefixCls('formily-array-base')\n  if (!array) return null\n  if (\n    array.field?.pattern !== 'editable' &&\n    array.field?.pattern !== 'disabled'\n  )\n    return null\n  return (\n    <Button\n      type=\"dashed\"\n      block\n      {...props}\n      disabled={self?.disabled}\n      className={cls(`${prefixCls}-addition`, props.className)}\n      onClick={(e) => {\n        if (array.props?.disabled) return\n        const defaultValue = getDefaultValue(props.defaultValue, array.schema)\n        if (props.method === 'unshift') {\n          array.field?.unshift?.(defaultValue)\n          array.props?.onAdd?.(0)\n        } else {\n          array.field?.push?.(defaultValue)\n          array.props?.onAdd?.(array?.field?.value?.length - 1)\n        }\n        if (props.onClick) {\n          props.onClick(e)\n        }\n      }}\n      icon={<PlusOutlined />}\n    >\n      {props.title || self.title}\n    </Button>\n  )\n}\n\nArrayBase.Copy = React.forwardRef((props, ref) => {\n  const self = useField()\n  const array = useArray()\n  const index = useIndex(props.index)\n  const prefixCls = usePrefixCls('formily-array-base')\n  if (!array) return null\n  if (array.field?.pattern !== 'editable') return null\n  return (\n    <CopyOutlined\n      {...props}\n      className={cls(\n        `${prefixCls}-copy`,\n        self?.disabled ? `${prefixCls}-copy-disabled` : '',\n        props.className\n      )}\n      ref={ref}\n      onClick={(e) => {\n        if (self?.disabled) return\n        e.stopPropagation()\n        if (array.props?.disabled) return\n        const value = clone(array?.field?.value[index])\n        const distIndex = index + 1\n        array.field?.insert?.(distIndex, value)\n        array.props?.onCopy?.(distIndex)\n        if (props.onClick) {\n          props.onClick(e)\n        }\n      }}\n    />\n  )\n})\n\nArrayBase.Remove = React.forwardRef((props, ref) => {\n  const index = useIndex(props.index)\n  const self = useField()\n  const array = useArray()\n  const prefixCls = usePrefixCls('formily-array-base')\n  if (!array) return null\n  if (array.field?.pattern !== 'editable') return null\n  return (\n    <DeleteOutlined\n      {...props}\n      className={cls(\n        `${prefixCls}-remove`,\n        self?.disabled ? `${prefixCls}-remove-disabled` : '',\n        props.className\n      )}\n      ref={ref}\n      onClick={(e) => {\n        if (self?.disabled) return\n        e.stopPropagation()\n        array.field?.remove?.(index)\n        array.props?.onRemove?.(index)\n        if (props.onClick) {\n          props.onClick(e)\n        }\n      }}\n    />\n  )\n})\n\nArrayBase.MoveDown = React.forwardRef((props, ref) => {\n  const index = useIndex(props.index)\n  const self = useField()\n  const array = useArray()\n  const prefixCls = usePrefixCls('formily-array-base')\n  if (!array) return null\n  if (array.field?.pattern !== 'editable') return null\n  return (\n    <DownOutlined\n      {...props}\n      className={cls(\n        `${prefixCls}-move-down`,\n        self?.disabled ? `${prefixCls}-move-down-disabled` : '',\n        props.className\n      )}\n      ref={ref}\n      onClick={(e) => {\n        if (self?.disabled) return\n        e.stopPropagation()\n        array.field?.moveDown?.(index)\n        array.props?.onMoveDown?.(index)\n        if (props.onClick) {\n          props.onClick(e)\n        }\n      }}\n    />\n  )\n})\n\nArrayBase.MoveUp = React.forwardRef((props, ref) => {\n  const index = useIndex(props.index)\n  const self = useField()\n  const array = useArray()\n  const prefixCls = usePrefixCls('formily-array-base')\n  if (!array) return null\n  if (array.field?.pattern !== 'editable') return null\n  return (\n    <UpOutlined\n      {...props}\n      className={cls(\n        `${prefixCls}-move-up`,\n        self?.disabled ? `${prefixCls}-move-up-disabled` : '',\n        props.className\n      )}\n      ref={ref}\n      onClick={(e) => {\n        if (self?.disabled) return\n        e.stopPropagation()\n        array?.field?.moveUp(index)\n        array?.props?.onMoveUp?.(index)\n        if (props.onClick) {\n          props.onClick(e)\n        }\n      }}\n    />\n  )\n})\n\nArrayBase.useArray = useArray\nArrayBase.useIndex = useIndex\nArrayBase.useRecord = useRecord\nArrayBase.mixin = (target: any) => {\n  target.Index = ArrayBase.Index\n  target.SortHandle = ArrayBase.SortHandle\n  target.Addition = ArrayBase.Addition\n  target.Copy = ArrayBase.Copy\n  target.Remove = ArrayBase.Remove\n  target.MoveDown = ArrayBase.MoveDown\n  target.MoveUp = ArrayBase.MoveUp\n  target.useArray = ArrayBase.useArray\n  target.useIndex = ArrayBase.useIndex\n  target.useRecord = ArrayBase.useRecord\n  return target\n}\n\nexport default ArrayBase\n"]}