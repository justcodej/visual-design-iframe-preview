!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react-is")):"function"==typeof define&&define.amd?define("formily.react",["exports","react-is"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).Formily=e.Formily||{},e.Formily.React={}))}(this,(function(e){"use strict";!function(){const e={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();var r=Symbol.for("__REVA_ACTIONS"),t={parent:!0,root:!0,properties:!0,patternProperties:!0,additionalProperties:!0,items:!0,additionalItems:!0,"x-linkages":!0,"x-reactions":!0},n={title:"title",description:"description",default:"initialValue",enum:"dataSource",readOnly:"readOnly",writeOnly:"editable","x-content":"content","x-data":"data","x-value":"value","x-editable":"editable","x-disabled":"disabled","x-read-pretty":"readPretty","x-read-only":"readOnly","x-visible":"visible","x-hidden":"hidden","x-display":"display","x-pattern":"pattern","x-validator":"validator","x-decorator":"decoratorType","x-component":"componentType","x-decorator-props":"decoratorProps","x-component-props":"componentProps"},i={required:!0,format:!0,maxItems:!0,minItems:!0,maxLength:!0,minLength:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,pattern:!0,const:!0,multipleOf:!0,maxProperties:!0,minProperties:!0,uniqueItems:!0},o=Object.prototype.hasOwnProperty,a=function(e){return"$$typeof"in e&&"_owner"in e||(!!e._isAMomentObject||(!!J.isSchemaInstance(e)||(!!e[r]||(!!Formily.Shared.isFn(e.toJS)||(!!Formily.Shared.isFn(e.toJSON)||!!Formily.Reactive.isObservable(e))))))},l=function(e,r,t){Formily.Reactive.untracked((function(){var o,a,l=Formily.Shared.FormPath.parse(r).segments,c=l[0],u="enum"===c&&Formily.Shared.isArr(t),d=n[c];d?Formily.Shared.FormPath.setIn(e,[d].concat(l.slice(1)),u?(a=t,Formily.Shared.toArr(a).map((function(e){return"object"==typeof e?e:{label:e,value:e}}))):t):i[c]&&(null===(o=e.setValidatorRule)||void 0===o||o.call(e,c,t))}))},c=/^\s*\{\{([\s\S]*)\}\}\s*$/,u={silent:!1,compile:function(e,r){if(void 0===r&&(r={}),!u.silent)return new Function("$root","with($root) { return (".concat(e,"); }"))(r);try{return new Function("$root","with($root) { return (".concat(e,"); }"))(r)}catch(e){}}},d=function(e){void 0===e&&(e=!0),u.silent=!!e},s=function(e){Formily.Shared.isFn(e)&&(u.compile=e)},m=function(e,r){if(Formily.Shared.isStr(e)){var t=e.match(c);return t?u.compile(t[1],r):e}return e},p=function(e,r){var t=[],n=function(e){if(Formily.Shared.isStr(e))return m(e,r);if(Formily.Shared.isArr(e))return e.map((function(e){return n(e)}));if(Formily.Shared.isPlainObj(e)){if(a(e))return e;if(t.indexOf(e)>-1)return e;var i=t.length;t.push(e);var o=Formily.Shared.reduce(e,(function(e,r,t){return e[t]=n(r),e}),{});return t.splice(i,1),o}return e};return n(e)},f=function(e,r,t){!function(e,r){var t=[],n=e,i=function(e,o){if(void 0===o&&(o=[]),Formily.Shared.isPlainObj(e)){if(t.indexOf(e)>-1)return;var l=t.length;if(t.push(e),a(e)&&n!==e)return void r(e,o);Formily.Shared.each(e,(function(e,r){i(e,o.concat(r))})),t.splice(l,1)}else r(e,o)};i(e)}(r,(function(r,n){var i=Formily.Shared.FormPath.parse(n),a=p(r,t),l=i.segments[0];void 0!==a&&o.call(e,l)&&Formily.Reactive.untracked((function(){return Formily.Shared.FormPath.setIn(e,i,a)}))}))},y=function(e,r,n,i){void 0===i&&(i=!1),function(e,r){void 0!==e["x-validator"]&&r(e["x-validator"],["x-validator"]);var n=[],i=e,o=function(l,c){var u;if(void 0===c&&(c=[]),"x-compile-omitted"!==c[0]&&"x-validator"!==c[0]&&"version"!==c[0]&&"_isJSONSchemaObject"!==c[0]&&!(-1==String(c[0]).indexOf("x-")&&Formily.Shared.isFn(l)||t[c[0]]))if((null===(u=e["x-compile-omitted"])||void 0===u?void 0:u.indexOf(c[0]))>-1)r(l,c,!0);else if(Formily.Shared.isPlainObj(l)){if("default"===c[0]||"x-value"===c[0])return void r(l,c);if(n.indexOf(l)>-1)return;var d=n.length;if(n.push(l),a(l)&&i!==l)return void r(l,c);Formily.Shared.each(l,(function(e,r){o(e,c.concat(r))})),n.splice(d,1)}else r(l,c)};o(e)}(r,(function(r,t,o){var a=r,c=Formily.Reactive.hasCollected((function(){o||(a=p(r,n))}));void 0!==a&&(i&&!c&&e.initialized||l(e,t,a))}))},v=function(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,i,o=t.call(e),a=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},h={onFieldInit:Formily.Core.onFieldInit,onFieldMount:Formily.Core.onFieldMount,onFieldUnmount:Formily.Core.onFieldUnmount,onFieldValueChange:Formily.Core.onFieldValueChange,onFieldInputValueChange:Formily.Core.onFieldInputValueChange,onFieldInitialValueChange:Formily.Core.onFieldInitialValueChange,onFieldValidateStart:Formily.Core.onFieldValidateStart,onFieldValidateEnd:Formily.Core.onFieldValidateEnd,onFieldValidateFailed:Formily.Core.onFieldValidateFailed,onFieldValidateSuccess:Formily.Core.onFieldValidateSuccess},F=["onFieldInit","onFieldValueChange"],S=function(e,r,t){var n=v(String(r).split(/\s*#\s*/),2),i=n[0],o=n[1];return e.query(i).getIn(o||t||"value")},P=function(e,r){void 0===r&&(r=!1);var t=e||{},n=t.request,i=t.target,o=t.runner,a=t.field,l=t.scope;n&&(i?(n.state&&a.form.setFieldState(i,(function(e){return f(e,n.state,Formily.Shared.lazyMerge(l,{$target:e}))})),n.schema&&a.form.setFieldState(i,(function(e){return y(e,n.schema,Formily.Shared.lazyMerge(l,{$target:e}),r)})),Formily.Shared.isStr(o)&&o&&a.form.setFieldState(i,(function(e){m("{{function(){".concat(o,"}}}"),Formily.Shared.lazyMerge(l,{$target:e}))()}))):(n.state&&a.setState((function(e){return f(e,n.state,l)})),n.schema&&a.setState((function(e){return y(e,n.schema,l,r)})),Formily.Shared.isStr(o)&&o&&m("{{function(){".concat(o,"}}}"),l)()))},g=function(e,r){void 0===r&&(r={});var t=Formily.Reactive.autorun.effect,n=Formily.Reactive.autorun.memo,i=e,o=e.form,a=e.form.values;return Formily.Shared.lazyMerge(r.scope,{$form:o,$self:i,$observable:function(e,r){return Formily.Reactive.autorun.memo((function(){return Formily.Reactive.observable(e)}),r)},$effect:t,$memo:n,$props:function(r){return e.setComponentProps(r)},$values:a})},R=function(e,r){return function(t){P({field:t,request:{schema:e},scope:g(t,r)},!0)}},b=function(e,r){return Formily.Shared.toArr(e["x-reactions"]).map((function(e){return function(t){var n=g(t,r),i=m(e,n);if(i){if(Formily.Shared.isFn(i))return i(t,n);var o=i.when,a=i.fulfill,l=i.otherwise,c=i.target,u=i.effects,d=function(){var e=function(e,r){if(Formily.Shared.isArr(r)){var t=[];return r.forEach((function(r){Formily.Shared.isStr(r)?t.push(S(e,r)):Formily.Shared.isPlainObj(r)&&r.name&&r.source&&(t[r.name]=S(e,r.source,r.property))})),t}return Formily.Shared.isPlainObj(r)?Formily.Shared.reduce(r,(function(r,t,n){return r[n]=S(e,t),r}),{}):[]}(t,i.dependencies),r=e,u=Formily.Shared.lazyMerge(n,{$target:null,$deps:e,$dependencies:r}),d=m(o,u),s=!o||d,p=s?a:l,f=s?null==a?void 0:a.run:null==l?void 0:l.run;P({field:t,target:c,request:p,runner:f,scope:u})};c&&(i.effects=(null==u?void 0:u.length)?u:F),i.effects?Formily.Reactive.autorun.memo((function(){Formily.Reactive.untracked((function(){Formily.Shared.each(i.effects,(function(e){h[e]&&h[e](t.address,d)}))}))}),[]):d()}}}))},x=function(){return x=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},x.apply(this,arguments)},O=[],E={},C=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];e.forEach((function(e){Formily.Shared.isFn(e)&&O.push(e)}))},N=function(e,r){e&&Formily.Shared.isFn(r)&&(E[e]=E[e]||[],E[e].push(r))},w=function(e){Formily.Shared.isArr(e)&&e.forEach((function(e){Formily.Shared.isArr(E[e])&&E[e].forEach((function(e){C(e)}))}))},I=function(){return I=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},I.apply(this,arguments)},j=function(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,i,o=t.call(e),a=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a},V=function(e,r,t){if(t||2===arguments.length)for(var n,i=0,o=r.length;i<o;i++)!n&&i in r||(n||(n=Array.prototype.slice.call(r,0,i)),n[i]=r[i]);return e.concat(n||Array.prototype.slice.call(r))},$=["card","block","grid-col","grid-row","grid","layout","step","tab","text-box"],A={},M=function(e){if(Formily.Shared.isStr(e))return e.replace(/\$value/,"$self.value")},k=function(e){var r;return Formily.Shared.isValid(e.editable)&&(e["x-editable"]=e["x-editable"]||e.editable,delete e.editable),Formily.Shared.isValid(e.visible)&&(e["x-visible"]=e["x-visible"]||e.visible,delete e.visible),Formily.Shared.isValid(e.display)&&(e["x-display"]=e["x-display"]||(e.display?"visible":"hidden"),delete e.display),Formily.Shared.isValid(e["x-props"])&&(e["x-decorator-props"]=e["x-decorator-props"]||e["x-props"],delete e.display),e["x-linkages"]&&(e["x-reactions"]=Formily.Shared.toArr(e["x-reactions"]).concat((r=e["x-linkages"],Formily.Shared.isArr(r)?r.reduce((function(e,r){return r?"value:visible"===r.type?e.concat({target:r.target,when:M(r.condition),fulfill:{state:{visible:!0}},otherwise:{state:{visible:!1}}}):"value:schema"===r.type?e.concat({target:r.target,when:M(r.condition),fulfill:{schema:k(I({version:"1.0"},r.schema))},otherwise:{schema:k(I({version:"1.0"},r.otherwise))}}):"value:state"===r.type?e.concat({target:r.target,when:M(r.condition),fulfill:{state:r.state},otherwise:{state:r.otherwise}}):void 0:e}),[]):[])),delete e["x-linkages"]),e["x-component"]?$.some((function(r){return Formily.Shared.lowerCase(r)===Formily.Shared.lowerCase(e["x-component"])}))&&(e.type="void"):A[e.type]&&(e["x-component"]=A[e.type]),e["x-decorator"]||"void"===e.type||"object"===e.type||(e["x-decorator"]=e["x-decorator"]||"FormItem"),e["x-rules"]&&(e["x-validator"]=[].concat(e["x-validator"]||[]).concat(e["x-rules"])),e};N("1.0",k);var T=function(e){$.push.apply($,V([],j(e),!1))},D=function(e){Object.assign(A,e)},J=function(){function e(r,n){var i=this;return this._isJSONSchemaObject=!0,this.version="2.0",this.addProperty=function(r,t){return i.properties=i.properties||{},i.properties[r]=new e(t,i),i.properties[r].name=r,i.properties[r]},this.removeProperty=function(e){var r=i.properties[e];return delete i.properties[e],r},this.setProperties=function(e){for(var r in e)i.addProperty(r,e[r]);return i},this.addPatternProperty=function(r,t){if(t)return i.patternProperties=i.patternProperties||{},i.patternProperties[r]=new e(t,i),i.patternProperties[r].name=r,i.patternProperties[r]},this.removePatternProperty=function(e){var r=i.patternProperties[e];return delete i.patternProperties[e],r},this.setPatternProperties=function(e){if(!e)return i;for(var r in e)i.addPatternProperty(r,e[r]);return i},this.setAdditionalProperties=function(r){if(r)return i.additionalProperties=new e(r),i.additionalProperties},this.setItems=function(r){if(r)return Array.isArray(r)?i.items=r.map((function(r){return new e(r,i)})):i.items=new e(r,i),i.items},this.setAdditionalItems=function(r){if(r)return i.additionalItems=new e(r,i),i.additionalItems},this.findDefinitions=function(e){if(e&&i.root&&Formily.Shared.isStr(e)&&0===e.indexOf("#/"))return Formily.Shared.FormPath.getIn(i.root,e.substring(2).split("/"))},this.mapProperties=function(r){return e.getOrderProperties(i).map((function(e,t){var n=e.schema,i=e.key;return r(n,i,t)}))},this.mapPatternProperties=function(r){return e.getOrderProperties(i,"patternProperties").map((function(e,t){var n=e.schema,i=e.key;return r(n,i,t)}))},this.reduceProperties=function(r,t){var n=t;return e.getOrderProperties(i,"properties").forEach((function(e,t){var i=e.schema,o=e.key;n=r(n,i,o,t)})),n},this.reducePatternProperties=function(r,t){var n=t;return e.getOrderProperties(i,"patternProperties").forEach((function(e,t){var i=e.schema,o=e.key;n=r(n,i,o,t)})),n},this.compile=function(r){var n=new e({},i.parent);return Formily.Shared.each(i,(function(e,i){Formily.Shared.isFn(e)&&!i.includes("x-")||"parent"!==i&&"root"!==i&&(n[i]=t[i]?e?m(e,r):e:e?p(e,r):e)})),n},this.fromJSON=function(r){return r?e.isSchemaInstance(r)?r:(Formily.Shared.each((t=r,O.reduce((function(e,r){return r(e)}),x({},t))),(function(e,r){Formily.Shared.isFn(e)&&!r.includes("x-")||("properties"===r?i.setProperties(e):"patternProperties"===r?i.setPatternProperties(e):"additionalProperties"===r?i.setAdditionalProperties(e):"items"===r?i.setItems(e):"additionalItems"===r?i.setAdditionalItems(e):"$ref"===r?i.fromJSON(i.findDefinitions(e)):i[r]=e)})),i):i;var t},this.toJSON=function(e){void 0===e&&(e=!0);var r={};return Formily.Shared.each(i,(function(t,n){var i,o;if((!Formily.Shared.isFn(t)||n.includes("x-"))&&"parent"!==n&&"root"!==n)if("properties"===n||"patternProperties"===n){if(!e)return;r[n]=Formily.Shared.map(t,(function(e){var r;return null===(r=null==e?void 0:e.toJSON)||void 0===r?void 0:r.call(e)}))}else if("additionalProperties"===n||"additionalItems"===n){if(!e)return;r[n]=null===(i=null==t?void 0:t.toJSON)||void 0===i?void 0:i.call(t)}else if("items"===n){if(!e)return;Array.isArray(t)?r[n]=t.map((function(e){var r;return null===(r=null==e?void 0:e.toJSON)||void 0===r?void 0:r.call(e)})):r[n]=null===(o=null==t?void 0:t.toJSON)||void 0===o?void 0:o.call(t)}else r[n]=t})),r},this.toFieldProps=function(e){return function(e,r){return{name:e.name,reactions:[R(e,r)].concat(b(e,r))}}(i,e)},n?(this.parent=n,this.root=n.root):this.root=this,this.fromJSON(r)}return e.getOrderProperties=function(e,r){void 0===e&&(e={}),void 0===r&&(r="properties");var t=[],n=[];for(var i in e[r]){var o=e[r][i],a=o["x-index"];isNaN(a)?n.push({schema:o,key:i}):t[a]={schema:o,key:i}}return t.concat(n).filter((function(e){return!!e}))},e.compile=function(e,r){return p(e,r)},e.shallowCompile=function(e,r){return m(e,r)},e.isSchemaInstance=function(r){return Formily.Shared.instOf(r,e)},e.registerCompiler=s,e.registerPatches=C,e.registerVoidComponents=T,e.registerTypeDefaultComponents=D,e.registerPolyfills=N,e.enablePolyfills=w,e.silent=d,e}(),_=function(e){return Formily.ReactiveReact.unstable_useCompatEffect((function(){return e.onMount(),function(){return e.onUnmount()}}),[e]),e},z=React.createContext(null),q=React.createContext(null),B=React.createContext(null),L=React.createContext(null),U=React.createContext(null),G=React.createContext(null),H=React.createContext(null),K=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(r){var t=r.children;return e.reduce((function(e,r){return React.createElement(r.Provider,{value:void 0},e)}),t)}}(q,B,L,U,G,H),Q=function(){return Q=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},Q.apply(this,arguments)};function W(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,i,o=t.call(e),a=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a}function X(e,r){for(var t=0,n=r.length,i=e.length;t<n;t++,i++)e[i]=r[t];return e}var Y=function(){return React.useContext(z)},Z=function(){return React.useContext(q)},ee=function(){return React.useContext(U)};const re=ReactIs;var te={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},ne={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},ie={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},oe={};function ae(e){return re.isMemo(e)?ie:oe[e.$$typeof]||te}oe[re.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},oe[re.Memo]=ie;var le=Object.defineProperty,ce=Object.getOwnPropertyNames,ue=Object.getOwnPropertySymbols,de=Object.getOwnPropertyDescriptor,se=Object.getPrototypeOf,me=Object.prototype;var pe=function e(r,t,n){if("string"!=typeof t){if(me){var i=se(t);i&&i!==me&&e(r,i,n)}var o=ce(t);ue&&(o=o.concat(ue(t)));for(var a=ae(r),l=ae(t),c=0;c<o.length;++c){var u=o[c];if(!(ne[u]||n&&n[u]||l&&l[u]||a&&a[u])){var d=de(t,u);try{le(r,u,d)}catch(e){}}}}return r};const fe=Formily.ReactiveReact.observer,ye=Formily.ReactiveReact.Observer;var ve=function(e){var r=_(e.form);return React.createElement(K,null,React.createElement(z.Provider,{value:r},e.children))};ve.displayName="FormProvider";var he=Formily.ReactiveReact.observer((function(e){var r=Formily.Shared.isFn(e.children)?e.children(Y()):null;return React.createElement(React.Fragment,null,r)}));he.displayName="FormConsumer";var Fe=function(e,r,t){return Formily.Shared.isFn(e)?e(r,t):e},Se=function(e){var r,t=React.useContext(G);if(!e.field)return React.createElement(React.Fragment,null,Fe(e.children));var n=e.field,i=function(e,r){if((e||r)&&!Formily.Shared.isFn(e))return React.createElement(React.Fragment,null,e,r)}(Fe(e.children,n,n.form),null!==(r=n.content)&&void 0!==r?r:n.componentProps.children);if("visible"!==n.display)return null;var o,a=function(e){var r;return function(e){return e&&("object"==typeof e||"function"==typeof e)}(e)?e:null!==(r=Formily.Shared.FormPath.getIn(t,e))&&void 0!==r?r:e};return o=function(){var e,r,t;if(!n.componentType)return i;var o=Formily.Core.isVoidField(n)?void 0:n.value,l=Formily.Core.isVoidField(n)?null===(e=n.componentProps)||void 0===e?void 0:e.onChange:function(){for(var e,r,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.onInput.apply(n,X([],W(t))),null===(r=null===(e=n.componentProps)||void 0===e?void 0:e.onChange)||void 0===r||r.call.apply(r,X([e],W(t)))},c=Formily.Core.isVoidField(n)?null===(r=n.componentProps)||void 0===r?void 0:r.onFocus:function(){for(var e,r,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.onFocus.apply(n,X([],W(t))),null===(r=null===(e=n.componentProps)||void 0===e?void 0:e.onFocus)||void 0===r||r.call.apply(r,X([e],W(t)))},u=Formily.Core.isVoidField(n)?null===(t=n.componentProps)||void 0===t?void 0:t.onBlur:function(){for(var e,r,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.onBlur.apply(n,X([],W(t))),null===(r=null===(e=n.componentProps)||void 0===e?void 0:e.onBlur)||void 0===r||r.call.apply(r,X([e],W(t)))},d=Formily.Core.isVoidField(n)?void 0:"disabled"===n.pattern||"readPretty"===n.pattern,s=Formily.Core.isVoidField(n)?void 0:"readOnly"===n.pattern;return React.createElement(a(n.componentType),Q(Q({disabled:d,readOnly:s},Formily.Reactive.toJS(n.componentProps)),{value:o,onChange:l,onFocus:c,onBlur:u}),i)}(),n.decoratorType?React.createElement(a(n.decoratorType),Formily.Reactive.toJS(n.decoratorProps),o):React.createElement(React.Fragment,null,o)};Se.displayName="ReactiveField";var Pe=Formily.ReactiveReact.observer(Se,{forwardRef:!0}),ge=function(e){var r=Y(),t=Z(),n=_(r.createArrayField(Q({basePath:null==t?void 0:t.address},e)));return React.createElement(q.Provider,{value:n},React.createElement(Pe,{field:n},e.children))};ge.displayName="ArrayField";var Re=function(e){var r=Y(),t=Z(),n=_(r.createObjectField(Q({basePath:null==t?void 0:t.address},e)));return React.createElement(q.Provider,{value:n},React.createElement(Pe,{field:n},e.children))};Re.displayName="ObjectField";var be=function(e){var r=Y(),t=Z(),n=_(r.createVoidField(Q({basePath:null==t?void 0:t.address},e)));return React.createElement(q.Provider,{value:n},React.createElement(Pe,{field:n},e.children))};be.displayName="VoidField";var xe=function(e){var r=Y(),t=Z(),n=_(r.createField(Q({basePath:null==t?void 0:t.address},e)));return React.createElement(q.Provider,{value:n},React.createElement(Pe,{field:n},e.children))};xe.displayName="Field";var Oe=function(e){var r,t,n=function(e){var r=Z();return e.onlyRenderProperties?e.basePath||(null==r?void 0:r.address.concat(e.name)):e.basePath||(null==r?void 0:r.address)}(e),i=React.useMemo((function(){return new Formily.JSONSchema.Schema(e.schema)}),[e.schema]),o=(r=i,t=ee(),r.toFieldProps({scope:t})),a=function(r){if(!e.onlyRenderSelf){var t=Formily.JSONSchema.Schema.getOrderProperties(i);if(t.length)return React.createElement(React.Fragment,null,t.map((function(t,i){var o=t.schema,a=t.key,l=(null==r?void 0:r.address)||n,c=o;if(Formily.Shared.isFn(e.mapProperties)){var u=e.mapProperties(o,a);u&&(c=u)}return Formily.Shared.isFn(e.filterProperties)&&!1===e.filterProperties(c,a)?null:React.createElement(Oe,{schema:c,key:"".concat(i,"-").concat(a),name:a,basePath:l})})))}};return i?React.createElement(L.Provider,{value:i},Formily.Shared.isValid(e.name)?"object"===i.type?e.onlyRenderProperties?a():React.createElement(Re,Q({},o,{name:e.name,basePath:n}),a):"array"===i.type?React.createElement(ge,Q({},o,{name:e.name,basePath:n})):"void"===i.type?e.onlyRenderProperties?a():React.createElement(be,Q({},o,{name:e.name,basePath:n}),a):React.createElement(xe,Q({},o,{name:e.name,basePath:n})):a()):React.createElement(React.Fragment,null)},Ee=function(e){var r=React.useContext(U);return React.createElement(U.Provider,{value:Formily.Shared.lazyMerge(r,e.value)},e.children)},Ce={portalDOM:null},Ne={nonameId:0};e.ArrayField=ge,e.ContextCleaner=K,e.ExpressionScope=Ee,e.Field=xe,e.FieldContext=q,e.FormConsumer=he,e.FormContext=z,e.FormProvider=ve,e.ObjectField=Re,e.Observer=ye,e.RecordScope=function(e){var r=ee();return React.createElement(Ee,{value:{get $lookup(){return null==r?void 0:r.$record},get $record(){var t,n=null===(t=e.getRecord)||void 0===t?void 0:t.call(e);return"object"==typeof n?Formily.Shared.lazyMerge(n,{get $lookup(){return null==r?void 0:r.$record},get $index(){var r;return null===(r=e.getIndex)||void 0===r?void 0:r.call(e)}}):n},get $index(){var r;return null===(r=e.getIndex)||void 0===r?void 0:r.call(e)}}},e.children)},e.RecordsScope=function(e){return React.createElement(Ee,{value:{get $records(){var r,t;return null!==(t=null===(r=e.getRecords)||void 0===r?void 0:r.call(e))&&void 0!==t?t:[]}}},e.children)},e.RecursionField=Oe,e.Schema=J,e.SchemaComponentsContext=G,e.SchemaContext=L,e.SchemaExpressionScopeContext=U,e.SchemaMarkupContext=B,e.SchemaOptionsContext=H,e.VoidField=be,e.connect=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var n=r.reduce((function(e,r){return r(e)}),e),i=React.forwardRef((function(e,r){return React.createElement(n,Q(Q({},e),{ref:r}))}));return e&&pe(i,e),i},e.createSchemaField=function(e){function r(r){var t,n=Formily.JSONSchema.Schema.isSchemaInstance(r.schema)?r.schema:new Formily.JSONSchema.Schema(Q({type:"object"},r.schema));return React.createElement(H.Provider,{value:e},React.createElement(G.Provider,{value:Formily.Shared.lazyMerge(e.components,r.components)},React.createElement(Ee,{value:Formily.Shared.lazyMerge(e.scope,r.scope)},(Ne.nonameId=0,r.schema?null:(t=React.createElement(B.Provider,{value:n},r.children),Formily.Shared.globalThisPolyfill.document?(Ce.portalDOM=Ce.portalDOM||Formily.Shared.globalThisPolyfill.document.createElement("div"),ReactDOM.createPortal(t,Ce.portalDOM)):React.createElement("template",{},t))),React.createElement(Oe,Q({},r,{schema:n})))))}function t(e){var r=React.useContext(B);if(!r)return React.createElement(React.Fragment,null);var t=function(){return React.createElement(React.Fragment,null,e.children)};if("object"===r.type||"void"===r.type){var n=r.addProperty(e.name,e);return React.createElement(B.Provider,{value:n},t())}if("array"===r.type){n=function(t){var n=r.items;return n&&n.name!==e.name?r.addProperty(e.name,t):r.setItems(t)}(e);return React.createElement(B.Provider,{value:Array.isArray(n)?n[0]:n},e.children)}return t()}function n(e){return React.createElement(t,Q({},e,{name:e.name||"NO_NAME_FIELD_$".concat(Ne.nonameId++)}))}function i(e){return React.createElement(n,Q({},e,{type:"string"}))}function o(e){return React.createElement(n,Q({},e,{type:"object"}))}function a(e){return React.createElement(n,Q({},e,{type:"array"}))}function l(e){return React.createElement(n,Q({},e,{type:"boolean"}))}function c(e){return React.createElement(n,Q({},e,{type:"number"}))}function u(e){return React.createElement(n,Q({},e,{type:"date"}))}function d(e){return React.createElement(n,Q({},e,{type:"datetime"}))}function s(e){return React.createElement(n,Q({},e,{type:"void"}))}return void 0===e&&(e={}),r.displayName="SchemaField",n.displayName="MarkupField",i.displayName="StringField",o.displayName="ObjectField",a.displayName="ArrayField",l.displayName="BooleanField",c.displayName="NumberField",u.displayName="DateField",d.displayName="DateTimeField",s.displayName="VoidField",r.Markup=n,r.String=i,r.Object=o,r.Array=a,r.Boolean=l,r.Date=u,r.DateTime=d,r.Void=s,r.Number=c,r},e.mapProps=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(r){return Formily.ReactiveReact.observer((function(t){var n=Z(),i=e.reduce((function(e,r){return Formily.Shared.isFn(r)?e=Object.assign(e,r(e,n)):Formily.Shared.each(r,(function(r,t){var i=Formily.Shared.FormPath.getIn(n,t),o=Formily.Shared.isStr(r)?r:t,a=Formily.Shared.FormPath.getIn(e,o);"value"===t&&r!==t&&delete e.value,Formily.Shared.isValid(a)&&!Formily.Shared.isValid(i)||Formily.Shared.FormPath.setIn(e,o,i)})),e}),Q({},t));return React.createElement(r,i)}),{forwardRef:!0})}},e.mapReadPretty=function(e,r){return function(t){return Formily.ReactiveReact.observer((function(n){var i=Z();return Formily.Core.isVoidField(i)||"readPretty"!==(null==i?void 0:i.pattern)?React.createElement(t,n):React.createElement(e,Q(Q({},r),n))}),{forwardRef:!0})}},e.observer=fe,e.useExpressionScope=ee,e.useField=Z,e.useFieldSchema=function(){return React.useContext(L)},e.useForm=Y,e.useFormEffects=function(e){var r=Y();Formily.ReactiveReact.unstable_useCompatFactory((function(){var t=Formily.Shared.uid();return r.addEffects(t,e),{dispose:function(){r.removeEffects(t)}}}))},e.useParentForm=function(){var e=Z(),r=Y(),t=function(e){return e?Formily.Core.isObjectField(e)?e:t(null==e?void 0:e.parent):r};return t(e)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=formily.react.umd.production.js.map
