'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _replace2 = require('ramda/src/replace');

var _replace3 = _interopRequireDefault(_replace2);

var _always2 = require('ramda/src/always');

var _always3 = _interopRequireDefault(_always2);

var _props2 = require('ramda/src/props');

var _props3 = _interopRequireDefault(_props2);

var _head2 = require('ramda/src/head');

var _head3 = _interopRequireDefault(_head2);

var _ifElse2 = require('ramda/src/ifElse');

var _ifElse3 = _interopRequireDefault(_ifElse2);

var _2 = require('ramda/src/__');

var _3 = _interopRequireDefault(_2);

var _merge2 = require('ramda/src/merge');

var _merge3 = _interopRequireDefault(_merge2);

var _clone2 = require('ramda/src/clone');

var _clone3 = _interopRequireDefault(_clone2);

var _equals2 = require('ramda/src/equals');

var _equals3 = _interopRequireDefault(_equals2);

var _type2 = require('ramda/src/type');

var _type3 = _interopRequireDefault(_type2);

var _compose2 = require('ramda/src/compose');

var _compose3 = _interopRequireDefault(_compose2);

var _stringifyQuery = require('./stringify-query');

var _stringifyQuery2 = _interopRequireDefault(_stringifyQuery);

var _stringifyJSON = require('./stringify-j-s-o-n');

var _stringifyJSON2 = _interopRequireDefault(_stringifyJSON);

var _api = require('./api');

var _api2 = _interopRequireDefault(_api);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (url, data) {
  var method = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'post';
  var headers = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

  if ((0, _compose3.default)((0, _equals3.default)('Object'), _type3.default)(method)) {
    headers = method;
    method = 'post';
  }

  headers = (0, _compose3.default)((0, _merge3.default)({ 'Content-Type': 'application/json' }, _3.default), _clone3.default)(headers);

  var body = (0, _ifElse3.default)((0, _compose3.default)((0, _equals3.default)('application/x-www-form-urlencoded'), _head3.default, (0, _props3.default)(['Content-Type'])), (0, _compose3.default)(_always3.default, (0, _replace3.default)('?', ''), _stringifyQuery2.default)(data), (0, _always3.default)((0, _ifElse3.default)((0, _compose3.default)((0, _equals3.default)('String'), _type3.default), (0, _always3.default)(data), (0, _compose3.default)(_always3.default, _stringifyJSON2.default)(data))(data)))(headers);

  return fetch((0, _api2.default)(url), { method: method, headers: headers, body: body }).then(function (resp) {
    return resp.json();
  });
};